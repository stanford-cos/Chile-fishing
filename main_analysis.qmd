---
title: "Chile Easter Island Fishing Effort"
subtitle: "Exploritory Analysis"
author: 
  - name: Althea Marks
    orcid: 0000-0002-9370-9128
    email: amarks1@stanford.edu
    affiliations:
      - name: Stanford Center for Ocean Solutions
date: "`r Sys.Date()`"
format: 
  html: 
    number-sections: true
    toc: true
    code-tools: true
    theme: cosmo 
    self-contained: true
    page-layout: full
title-block-banner: images/Image.png
title-block-banner-color: white
---

```{r setup, include=FALSE}
# Code chunk setup options
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE)

# libraries
library(readr)
library(tidyverse)
library(renv)
library(knitr)

# directories
data_dir <- file.path("./data")
out_dir <- file.path("./output")
scripts_dir <- file.path("./scripts")

# load functions
source(file.path(scripts_dir, "functions.R"))
```

# Easter Island EEZ AIS Fishing Effort

```{r get_marine_boundaries_easter_island, eval = F}
source(file.path(scripts_dir, "easter_island_geometry.R"))
```   

```{r easter_data_analysis}
# load ata pulled from GFW via scripts/gfw_chl_ais_easter_isl.sql
easter_data <- read_csv(file.path(data_dir, 
                                  "gfw_fish_ef_easter_isl_2019-01-01_2023-09-12.csv"))
# load Country ISO key from https://github.com/lukes/ISO-3166-Countries-with-Regional-Codes/blob/master/all/all.csv
country_names <- read_csv(file.path(data_dir, "ISO-3166-Countries.csv"))

easter_summary <- easter_data |> 
  rename("alpha-3" = best_flag) |> 
  left_join(country_names, by = "alpha-3") |> 
  group_by(name, best_vessel_class) |> 
  summarise(total_fishing_hrs = round(sum(fishing_hours),2),
            total_vessel_n = length(unique(ssvid))) |> 
  arrange(desc(total_fishing_hrs))

easter_gear <- easter_summary |> 
  group_by(best_vessel_class) |> 
  summarise(total_fishing_hrs = sum(total_fishing_hrs),
            vessel_n = sum(total_vessel_n))|> 
  arrange(desc(total_fishing_hrs))

easter_flag <- easter_summary |> 
  group_by(name) |> 
  summarise(total_fishing_hrs = sum(total_fishing_hrs),
            vessel_n = sum(total_vessel_n))|> 
  arrange(desc(total_fishing_hrs))
  
```

2019 January 1st - 2023 September 12th:

- ``r sum(easter_summary$total_vessel_n)` vessels` fished within EEZ boundary 
- Total of ``r round(sum(easter_summary$total_fishing_hrs), 2)` hours`
- Effort from ``r nrow(unique(easter_summary[!is.na(easter_summary$name),]))` flag states`
- Most fishing effort from ` `r easter_flag[1,1]``
- Most fishing effort from ` `r easter_gear[1,1]` `gear type

```{r tbl_easter_isalnd_flag}
kable(easter_flag,
      col.names = c("Best Flag", "Total Fishing Hours", "Number of Vessels"),
      caption = "Flag")
```

```{r tbl_easter_island_gear}

kable(easter_gear,
      col.names = c("Vessel Class", "Total Fishing Hours", "Number of Vessels"),
      caption = "Gear")
```

```{r tbl_easter_island_summary}

kable(easter_summary, 
      col.names = c("Best Flag", "Vessel Class", "Total Fishing Hours", 
                                    "Number of Vessels"),
      caption = "Flag & Gear")
```

## Fishing Effort x Time

```{r}

```


## Fishing Effort Map

```{r}

```


# Fishing Hours Heat Map

Using GFW map is the best option for large amounts of data.
